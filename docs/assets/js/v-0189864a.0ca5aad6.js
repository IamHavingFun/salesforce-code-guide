(self.webpackChunksalesforce_code_guide=self.webpackChunksalesforce_code_guide||[]).push([[944],{806:(s,n,a)=>{"use strict";a.r(n),a.d(n,{data:()=>e});const e={key:"v-0189864a",path:"/architecture/apex/",title:"Apex Architecture Guide",lang:"en-US",frontmatter:{},excerpt:"",headers:[{level:2,title:"Prefer specialized classes with focused responsibility",slug:"prefer-specialized-classes-with-focused-responsibility",children:[]},{level:2,title:"Prefer decoupled logic in separate methods",slug:"prefer-decoupled-logic-in-separate-methods",children:[]},{level:2,title:"Prefer instance methods over static methods",slug:"prefer-instance-methods-over-static-methods",children:[]},{level:2,title:"Prefer enforcing sharing settings",slug:"prefer-enforcing-sharing-settings",children:[]}],filePathRelative:"architecture/apex/README.md",git:{updatedTime:1616683976e3,contributors:[{name:"Georg Wittberger",email:"georg.wittberger@gmail.com",commits:1}]}}},542:(s,n,a)=>{"use strict";a.r(n),a.d(n,{default:()=>i});var e=a(252);const t=(0,e.uE)('<h1 id="apex-architecture-guide"><a class="header-anchor" href="#apex-architecture-guide">#</a> Apex Architecture Guide</h1><p>This document explains some architectural guidelines to help with writing high quality Apex code.</p><h2 id="prefer-specialized-classes-with-focused-responsibility"><a class="header-anchor" href="#prefer-specialized-classes-with-focused-responsibility">#</a> Prefer specialized classes with focused responsibility</h2><blockquote><p>Classes with focused responsibility are easier to understand and easier to maintain.</p></blockquote><div class="custom-container danger"><p class="custom-container-title">BAD</p><div class="language-apex ext-apex line-numbers-mode"><pre class="language-apex"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GeneralUtils</span> <span class="token punctuation">{</span>\n  <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">List</span><span class="token punctuation">&lt;</span>Account<span class="token punctuation">&gt;</span></span> <span class="token function">getAccountsByIds</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">Set</span><span class="token punctuation">&lt;</span>Id<span class="token punctuation">&gt;</span></span> accountIds<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n  <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">List</span><span class="token punctuation">&lt;</span>Contact<span class="token punctuation">&gt;</span></span> <span class="token function">getContactsByIds</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">Set</span><span class="token punctuation">&lt;</span>Id<span class="token punctuation">&gt;</span></span> contactIds<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>The class takes responsibility for two different functionalities.</p></div><div class="custom-container tip"><p class="custom-container-title">BETTER</p><div class="language-apex ext-apex line-numbers-mode"><pre class="language-apex"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AccountProvider</span> <span class="token punctuation">{</span>\n  <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">List</span><span class="token punctuation">&lt;</span>Account<span class="token punctuation">&gt;</span></span> <span class="token function">getAccountsByIds</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">Set</span><span class="token punctuation">&lt;</span>Id<span class="token punctuation">&gt;</span></span> accountIds<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ContactProvider</span> <span class="token punctuation">{</span>\n  <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">List</span><span class="token punctuation">&lt;</span>Contact<span class="token punctuation">&gt;</span></span> <span class="token function">getContactsByIds</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">Set</span><span class="token punctuation">&lt;</span>Id<span class="token punctuation">&gt;</span></span> contactIds<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>There are two separate classes for the different functionalities.</p></div><p>Classes with too many different responsibilities typically emerge from the evolution of a software project. Most developers care about splitting business logic into reusable methods. However, a common mistake is to put these methods into generic classes which end up being a dump for logic which is not related to each other.</p><p>The problem with these &quot;god classes&quot; is that they can grow to hundreds and even thousands of lines of code. This makes it hard for developers to understand the scope of the classes which often leads to an indifferent attitude when it comes to extension of the software: <em>&quot;I didn&#39;t know where to put this new logic, so I just dumped it there in our general class.&quot;</em></p><p>Apart from being a magnet for arbitrary logic &quot;god classes&quot; can make it more difficult to maintain the software. Almost no developer has a holistic overview of all the logic contained in these classes. The classes are refactored or cleaned up less often because nobody dares to touch them. This can lead to dead code which just bloats the software with unnecessary complexity.</p><p>The recommendation is to create rather small classes with limited responsibility. This is called the <em>single responsibility principle</em>. Each class should be scoped to a very particular purpose which can often be composed from a business/technical domain and a certain functionality within that domain. For example, a class can serve as a provider for Account records, restricting its scope to the Account domain and the functionality of querying the data. Be careful with just plain domain-specific classes like a &quot;product service&quot;. They tend to become dumps for unrelated domain logic as well.</p><h2 id="prefer-decoupled-logic-in-separate-methods"><a class="header-anchor" href="#prefer-decoupled-logic-in-separate-methods">#</a> Prefer decoupled logic in separate methods</h2><blockquote><p>Separate methods enable better reusability and extensibility of business logic.</p></blockquote><div class="custom-container danger"><p class="custom-container-title">BAD</p><div class="language-apex ext-apex line-numbers-mode"><pre class="language-apex"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AccountCleaner</span> <span class="token punctuation">{</span>\n  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">cleanupDuplicateAccounts</span><span class="token punctuation">(</span><span class="token keyword">Integer</span> minNumberOfEmployees<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token class-name"><span class="token keyword">List</span><span class="token punctuation">&lt;</span>Account<span class="token punctuation">&gt;</span></span> accounts<span class="token punctuation">;</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>minNumberOfEmployees <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      accounts <span class="token operator">=</span> <span class="token sql language-sql"><span class="token punctuation">[</span>\n        <span class="token keyword">SELECT</span> Name <span class="token keyword">FROM</span> Account\n        <span class="token keyword">WHERE</span> NumberOfEmployees <span class="token operator">&gt;=</span> :minNumberOfEmployees\n        <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> CreatedDate <span class="token keyword">DESC</span>\n      <span class="token punctuation">]</span></span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n      accounts <span class="token operator">=</span> <span class="token sql language-sql"><span class="token punctuation">[</span><span class="token keyword">SELECT</span> Name <span class="token keyword">FROM</span> Account <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> CreatedDate <span class="token keyword">DESC</span><span class="token punctuation">]</span></span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    <span class="token class-name"><span class="token keyword">Set</span><span class="token punctuation">&lt;</span><span class="token keyword">String</span><span class="token punctuation">&gt;</span></span> visitedAccountNames <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token keyword">Set</span><span class="token punctuation">&lt;</span><span class="token keyword">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token class-name"><span class="token keyword">List</span><span class="token punctuation">&lt;</span>Account<span class="token punctuation">&gt;</span></span> duplicateAccounts <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token keyword">List</span><span class="token punctuation">&lt;</span>Account<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Account</span> account <span class="token operator">:</span> accounts<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>visitedAccountNames<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>account<span class="token punctuation">.</span>Name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        duplicateAccounts<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>account<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">continue</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n      visitedAccountNames<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>account<span class="token punctuation">.</span>Name<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>duplicateAccounts<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">delete</span> duplicateAccounts<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p>The issue is that the method encapsulates both the query of relevant Account records and the logic for detecting and removing duplicates. If more query criteria should be introduced in the future it can be tempting to just add more method parameters to differentiate how the records are queried.</p></div><div class="custom-container tip"><p class="custom-container-title">BETTER</p><div class="language-apex ext-apex line-numbers-mode"><pre class="language-apex"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AccountCleaner</span> <span class="token punctuation">{</span>\n  <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">List</span><span class="token punctuation">&lt;</span>Account<span class="token punctuation">&gt;</span></span> <span class="token function">getAllAccountsLatestFirst</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token sql language-sql"><span class="token punctuation">[</span><span class="token keyword">SELECT</span> Name <span class="token keyword">FROM</span> Account <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> CreatedDate <span class="token keyword">DESC</span><span class="token punctuation">]</span></span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">List</span><span class="token punctuation">&lt;</span>Account<span class="token punctuation">&gt;</span></span> <span class="token function">getAccountsWithMinEmployeesLatestFirst</span><span class="token punctuation">(</span>\n    <span class="token keyword">Integer</span> minNumberOfEmployees\n  <span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token sql language-sql"><span class="token punctuation">[</span>\n      <span class="token keyword">SELECT</span> Name <span class="token keyword">FROM</span> Account\n      <span class="token keyword">WHERE</span> NumberOfEmployees <span class="token operator">&gt;=</span> :minNumberOfEmployees\n      <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> CreatedDate <span class="token keyword">DESC</span>\n    <span class="token punctuation">]</span></span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">deleteDuplicateAccounts</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">List</span><span class="token punctuation">&lt;</span>Account<span class="token punctuation">&gt;</span></span> accounts<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token class-name"><span class="token keyword">Set</span><span class="token punctuation">&lt;</span><span class="token keyword">String</span><span class="token punctuation">&gt;</span></span> visitedAccountNames <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token keyword">Set</span><span class="token punctuation">&lt;</span><span class="token keyword">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token class-name"><span class="token keyword">List</span><span class="token punctuation">&lt;</span>Account<span class="token punctuation">&gt;</span></span> duplicateAccounts <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token keyword">List</span><span class="token punctuation">&lt;</span>Account<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Account</span> account <span class="token operator">:</span> accounts<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>visitedAccountNames<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>account<span class="token punctuation">.</span>Name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        duplicateAccounts<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>account<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">continue</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n      visitedAccountNames<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>account<span class="token punctuation">.</span>Name<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>duplicateAccounts<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">delete</span> duplicateAccounts<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">cleanupOlderDuplicateAccountsOfLargeCompanies</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token class-name"><span class="token keyword">List</span><span class="token punctuation">&lt;</span>Account<span class="token punctuation">&gt;</span></span> largeCompanyAccounts <span class="token operator">=</span>\n      <span class="token function">getAccountsWithMinEmployeesLatestFirst</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">deleteDuplicateAccounts</span><span class="token punctuation">(</span>largeCompanyAccounts<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><p>The method for deleting duplicate Account records can be reused without modification while it is easy to introduce more types of queries for retrieving the list of records.</p><p>The method <code>cleanupOlderDuplicateAccountsOfLargeCompanies</code> is a higher-level method which composes lower-level methods.</p></div><p>Most developers tend to create one large method with all necessary logic as a first step because this is the easiest way to get things done quickly. However, this often means that the method encapsulates different subtasks and suffers from a high complexity. Due to the different levels of abstraction put together in one method it is harder for developers to get an overview of what the fundamental procedure of the method is.</p><p>Another drawback of large methods with too many integrated tasks is that they are hard to extend because everything is hard-wired and does not allow for external modification. A very naive approach is to introduce method parameters to enable the outer logic to control the behavior of the method. But this leads to more complexity inside the large method and makes it even harder to maintain. It is a violation of the so called <em>open closed principle</em>.</p><p>It is recommended to write rather small methods for dedicated small tasks and then compose these methods to higher-level business logic. These higher-level methods are easier to understand because they invoke the lower-level methods to accomplish their task. Developers do not have to care about how the lowest level works if they just want to explore the higher-level procedure.</p><p>An example of a software design pattern to help with decoupling of logic is the <em>strategy pattern</em>. Applied to the example above it looks as follows.</p><div class="language-apex ext-apex line-numbers-mode"><pre class="language-apex"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">AccountProvider</span> <span class="token punctuation">{</span>\n  <span class="token class-name"><span class="token keyword">List</span><span class="token punctuation">&lt;</span>Account<span class="token punctuation">&gt;</span></span> <span class="token function">getAccounts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LatestAccountsProvider</span> <span class="token keyword">implements</span> <span class="token class-name">AccountProvider</span> <span class="token punctuation">{</span>\n  <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">List</span><span class="token punctuation">&lt;</span>Account<span class="token punctuation">&gt;</span></span> <span class="token function">getAccounts</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token sql language-sql"><span class="token punctuation">[</span><span class="token keyword">SELECT</span> Name <span class="token keyword">FROM</span> Account <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> CreatedDate <span class="token keyword">DESC</span><span class="token punctuation">]</span></span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LatestAccountsMinEmployeesProvider</span> <span class="token keyword">implements</span> <span class="token class-name">AccountProvider</span> <span class="token punctuation">{</span>\n  <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">Integer</span> minNumberOfEmployees<span class="token punctuation">;</span>\n  <span class="token keyword">public</span> <span class="token function">LatestAccountsMinEmployeesProvider</span><span class="token punctuation">(</span><span class="token keyword">Integer</span> minNumberOfEmployees<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>minNumberOfEmployees <span class="token operator">=</span> minNumberOfEmployees<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">List</span><span class="token punctuation">&lt;</span>Account<span class="token punctuation">&gt;</span></span> <span class="token function">getAccounts</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token sql language-sql"><span class="token punctuation">[</span>\n      <span class="token keyword">SELECT</span> Name <span class="token keyword">FROM</span> Account\n      <span class="token keyword">WHERE</span> NumberOfEmployees <span class="token operator">&gt;=</span> :minNumberOfEmployees\n      <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> CreatedDate <span class="token keyword">DESC</span>\n    <span class="token punctuation">]</span></span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AccountCleaner</span> <span class="token punctuation">{</span>\n  <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">AccountProvider</span> provider<span class="token punctuation">;</span>\n  <span class="token keyword">public</span> <span class="token function">AccountCleaner</span><span class="token punctuation">(</span><span class="token class-name">AccountProvider</span> provider<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>provider <span class="token operator">=</span> provider<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">cleanupDuplicateAccounts</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token class-name"><span class="token keyword">List</span><span class="token punctuation">&lt;</span>Account<span class="token punctuation">&gt;</span></span> accounts <span class="token operator">=</span> provider<span class="token punctuation">.</span><span class="token function">getAccounts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token class-name"><span class="token keyword">Set</span><span class="token punctuation">&lt;</span><span class="token keyword">String</span><span class="token punctuation">&gt;</span></span> visitedAccountNames <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token keyword">Set</span><span class="token punctuation">&lt;</span><span class="token keyword">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token class-name"><span class="token keyword">List</span><span class="token punctuation">&lt;</span>Account<span class="token punctuation">&gt;</span></span> duplicateAccounts <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token keyword">List</span><span class="token punctuation">&lt;</span>Account<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Account</span> account <span class="token operator">:</span> accounts<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>visitedAccountNames<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>account<span class="token punctuation">.</span>Name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        duplicateAccounts<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>account<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">continue</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n      visitedAccountNames<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>account<span class="token punctuation">.</span>Name<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>duplicateAccounts<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">delete</span> duplicateAccounts<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><p>The cleanup procedure is strictly separated from the logic providing the Account records. The higher-level business logic can create the appropriate provider and then pass it to the cleaner instance.</p><div class="language-apex ext-apex line-numbers-mode"><pre class="language-apex"><code><span class="token class-name">AccountProvider</span> latestAccountsProvider <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LatestAccountsMinEmployeesProvider</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">new</span> <span class="token class-name">AccountCleaner</span><span class="token punctuation">(</span>latestAccountsProvider<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">cleanupDuplicateAccounts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="prefer-instance-methods-over-static-methods"><a class="header-anchor" href="#prefer-instance-methods-over-static-methods">#</a> Prefer instance methods over static methods</h2><blockquote><p>Instance methods support better extensibility and unit testing.</p></blockquote><div class="custom-container danger"><p class="custom-container-title">BAD</p><div class="language-apex ext-apex line-numbers-mode"><pre class="language-apex"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AccountProvider</span> <span class="token punctuation">{</span>\n  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name"><span class="token keyword">List</span><span class="token punctuation">&lt;</span>Account<span class="token punctuation">&gt;</span></span> <span class="token function">getAccountsByName</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">Set</span><span class="token punctuation">&lt;</span><span class="token keyword">String</span><span class="token punctuation">&gt;</span></span> names<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token sql language-sql"><span class="token punctuation">[</span><span class="token keyword">SELECT</span> Name <span class="token keyword">FROM</span> Account <span class="token keyword">WHERE</span> Name <span class="token operator">IN</span> :names<span class="token punctuation">]</span></span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AccountProcessor</span> <span class="token punctuation">{</span>\n  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">processAccounts</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token class-name"><span class="token keyword">Set</span><span class="token punctuation">&lt;</span><span class="token keyword">String</span><span class="token punctuation">&gt;</span></span> accountNames <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token keyword">Set</span><span class="token punctuation">&lt;</span><span class="token keyword">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span> <span class="token string">&#39;foo&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;bar&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>\n    <span class="token class-name"><span class="token keyword">List</span><span class="token punctuation">&lt;</span>Account<span class="token punctuation">&gt;</span></span> accounts <span class="token operator">=</span> AccountProvider<span class="token punctuation">.</span><span class="token function">getAccountsByName</span><span class="token punctuation">(</span>accountNames<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">// Do something with accounts</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>The processor is hard-wired with the provider making it impossible to extend how Account records are loaded. Testing the processor means that the provider is implicitly tested as well.</p></div><div class="custom-container tip"><p class="custom-container-title">BETTER</p><div class="language-apex ext-apex line-numbers-mode"><pre class="language-apex"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AccountProvider</span> <span class="token punctuation">{</span>\n  <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">List</span><span class="token punctuation">&lt;</span>Account<span class="token punctuation">&gt;</span></span> <span class="token function">getAccountsByName</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">Set</span><span class="token punctuation">&lt;</span><span class="token keyword">String</span><span class="token punctuation">&gt;</span></span> names<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token sql language-sql"><span class="token punctuation">[</span><span class="token keyword">SELECT</span> Name <span class="token keyword">FROM</span> Account <span class="token keyword">WHERE</span> Name <span class="token operator">IN</span> :names<span class="token punctuation">]</span></span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AccountProcessor</span> <span class="token punctuation">{</span>\n  <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">AccountProvider</span> provider<span class="token punctuation">;</span>\n  <span class="token keyword">public</span> <span class="token function">AccountProcessor</span><span class="token punctuation">(</span><span class="token class-name">AccountProvider</span> provider<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>provider <span class="token operator">=</span> provider<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">processAccounts</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token class-name"><span class="token keyword">Set</span><span class="token punctuation">&lt;</span><span class="token keyword">String</span><span class="token punctuation">&gt;</span></span> accountNames <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token keyword">Set</span><span class="token punctuation">&lt;</span><span class="token keyword">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span> <span class="token string">&#39;foo&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;bar&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>\n    <span class="token class-name"><span class="token keyword">List</span><span class="token punctuation">&lt;</span>Account<span class="token punctuation">&gt;</span></span> accounts <span class="token operator">=</span> provider<span class="token punctuation">.</span><span class="token function">getAccountsByName</span><span class="token punctuation">(</span>accountNames<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">// Do something with accounts</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>The provider can be injected into the processor which enables extensibility and allows to plug in a fake implementation during unit tests.</p></div><p>Composing higher-level business logic using static methods leads to a hard-wired graph of dependencies among classes. This makes it impossible to exchange only certain parts of the lower-level logic while reusing the rest.</p><p>Moreover, testing higher-level classes becomes more complicated because their methods always invoke the lower-level logic as well. The unit tests of such higher-level classes are typically bloated with test setup code to establish the proper test conditions which meet the requirements of all the lower-level classes.</p><p>It is recommended to use instance methods because they promote loose coupling which gives the flexibility to replace certain parts of the logic to achieve a different result. For example, being able to exchange the Account provider in the example above makes the processor extensible for different use cases.</p><p>Furthermore, when a class uses instance methods of its dependencies the behavior of those dependencies can be mocked during unit tests. This means that the real implementation is replaced with a fake implementation to simulate a cetain test scenario. This can save a lot of test setup code in the higher-level unit tests.</p>',29),p=(0,e.Uk)("See the "),o={href:"https://github.com/apex-enterprise-patterns/fflib-apex-mocks",target:"_blank",rel:"noopener noreferrer"},c=(0,e.Uk)("FFLib ApexMocks Framework"),l=(0,e.Uk)(" for an easy to use mocking library."),u=(0,e.uE)('<h2 id="prefer-enforcing-sharing-settings"><a class="header-anchor" href="#prefer-enforcing-sharing-settings">#</a> Prefer enforcing sharing settings</h2><blockquote><p>Classes respecting sharing settings contribute to more secure software.</p></blockquote><div class="custom-container danger"><p class="custom-container-title">BAD</p><div class="language-apex ext-apex line-numbers-mode"><pre class="language-apex"><code><span class="token keyword">public</span> <span class="token keyword">without sharing</span> <span class="token keyword">class</span> <span class="token class-name">AccountProvider</span> <span class="token punctuation">{</span>\n  <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">List</span><span class="token punctuation">&lt;</span>Account<span class="token punctuation">&gt;</span></span> <span class="token function">getAccounts</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token sql language-sql"><span class="token punctuation">[</span><span class="token keyword">SELECT</span> Id<span class="token punctuation">,</span> Name <span class="token keyword">FROM</span> Account<span class="token punctuation">]</span></span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>The class does not enforce sharing settings for the SOQL query. This may become a security risk.</p></div><div class="custom-container tip"><p class="custom-container-title">BETTER</p><div class="language-apex ext-apex line-numbers-mode"><pre class="language-apex"><code><span class="token keyword">public</span> <span class="token keyword">with sharing</span> <span class="token keyword">class</span> <span class="token class-name">AccountProvider</span> <span class="token punctuation">{</span>\n  <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">List</span><span class="token punctuation">&lt;</span>Account<span class="token punctuation">&gt;</span></span> <span class="token function">getAccounts</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token sql language-sql"><span class="token punctuation">[</span><span class="token keyword">SELECT</span> Id<span class="token punctuation">,</span> Name <span class="token keyword">FROM</span> Account<span class="token punctuation">]</span></span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>The class enforces sharing settings which makes it more secure.</p></div><p>The record sharing concept of Salesforce is an important mechanism for secure data management. It prevents users from accessing records which they are not supposed to access. When implementing code which is eventually executed by different users with various permissions it can be tempting to simply declare a class <code>without sharing</code> to get rid of the annoying problem that the logic does not work for some users because they do not have access to the records as required by the code. This introduces security risks because every user who is allowed to access the Apex class implicitly has access to the data that it queries.</p><p>It is recommended to enforce sharing settings whenever possible. Even if it is a little bit more effort you should rather install proper sharing rules which explicitly define which records can be accessed by which user group. For special use cases you can even create sharing records manually using Apex code.</p><p>Use <code>without sharing</code> only as a last resort.</p>',7),i={render:function(s,n){const a=(0,e.up)("OutboundLink");return(0,e.wg)(),(0,e.j4)(e.HY,null,[t,(0,e.Wm)("p",null,[p,(0,e.Wm)("a",o,[c,(0,e.Wm)(a)]),l]),u],64)}}}}]);